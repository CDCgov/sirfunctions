% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/generate_surv_reg_tab.R
\name{generate_surv_reg_tab}
\alias{generate_surv_reg_tab}
\title{Regional Surveillance Indicators by Year (Multi-country aggregate)}
\usage{
generate_surv_reg_tab(
  ctry_data,
  ctry.extract,
  dist.extract,
  cstool,
  dstool,
  afp.cases,
  start_year = NULL,
  end_year = NULL,
  output = c("flextable", "tibble")
)
}
\arguments{
\item{ctry_data}{A list-like object that contains at least \code{dist.pop}, a data
frame with district metadata. Must include columns:
\itemize{
\item \code{ctry} (country code/name),
\item \code{adm2guid} (district id),
and preferably \code{year} and a U15 population column (e.g., \code{u15pop}).
}}

\item{ctry.extract}{Country-level dataset (one row per country-year). Should
contain \code{year} and either \code{adm0guid} (to join with \code{cstool}) or
\code{ctry}. It should include \code{npafp_rate} and \code{per.stool.ad}, or columns that
can be unambiguously renamed to these.}

\item{dist.extract}{District-level dataset (one row per district-year) with
at minimum \code{adm2guid} and \code{year}. If it already contains \code{u15pop},
\code{npafp_rate}, \code{per.stool.ad}, those are used; otherwise they may be pulled
in via joins.}

\item{cstool}{Country-level surveillance stool adequacy dataset with \code{year} and
either \code{adm0guid} or \code{ctry}, containing \code{npafp_rate} and \code{per.stool.ad}
(or columns that can be renamed to these).}

\item{dstool}{District-level surveillance stool adequacy dataset with \code{adm2guid},
\code{year}, and indicator columns such as \code{npafp_rate}, \code{per.stool.ad}.}

\item{afp.cases}{Either:
\itemize{
\item country-year AFP case data with columns \code{ctry}, \code{year}, and a cases
column (e.g., \code{afp.cases}, \code{afp.case}, \code{cases}) \strong{or}
\item region/overall year totals with \code{year} and a cases column.
The function will rename the first matching cases column to \code{afp.cases}.
}}

\item{start_year, end_year}{Optional numeric bounds to filter the analysis
years, inclusive.}

\item{output}{One of \code{"flextable"} (default) or \code{"tibble"}. When \code{"tibble"},
returns a data frame with columns:
\code{year}, \code{afp.cases}, \code{npafp_rate}, \code{per.stool.ad}, \code{prop.dist.adeq}, \code{prop}.}
}
\value{
A \code{flextable} (default) for presentation, or a tibble when
\code{output = "tibble"}.
}
\description{
Computes \strong{region-level} time series of surveillance indicators by
aggregating across all countries present in your inputs (or implicitly after
the joins). The function:
\enumerate{
\item builds district-level indicators, restricts to districts with \strong{U15 ≥ 100,000},
\item derives the \strong{\% population in adequate districts} (NPAFP rate ≥ 2 \strong{and}
stool adequacy ≥ 80\%), and counts of adequate vs. total ≥100k districts,
\item aggregates \strong{country-level} indicators to the region using \strong{simple means}
for rates and \strong{sums} for AFP cases, and
\item returns either a tidy tibble or a formatted \code{flextable}.
}
}
\details{
\strong{U15 population column detection}: the function tries to ensure a column
named \code{u15pop} exists in the joined district data by:
\enumerate{
\item coalescing \code{u15pop.x}/\code{u15pop.y} after joins,
\item renaming common aliases (e.g., \code{u15_pop}, \code{U15Pop}, \code{under15_pop}), or
\item importing from \code{ctry_data$dist.pop} by \code{adm2guid} and \code{year}.
}

\strong{Adequacy rule (district level)}:
\itemize{
\item Adequate if \code{npafp_rate >= 2} \strong{and} \code{per.stool.ad >= 80}.
\item The \% population in adequate ≥100k districts is:
\eqn{100 * (sum(U15 in adequate ≥100k districts) / sum(U15 in all ≥100k districts))}.

*\emph{Aggregation}*:
\item AFP cases: summed across countries per year.
\item \code{npafp_rate} and \code{per.stool.ad}: \strong{simple means} across countries per year
(switch to a weighted mean if needed).
}

The output \code{flextable} renders \code{year} as plain text (no thousands separator).
}
\examples{
\dontrun{
ft <- generate_surv_reg_tab(
  ctry_data    = ctry_data,
  ctry.extract = ctry.extract,
  dist.extract = dist.extract,
  cstool       = cstool,
  dstool       = dstool,
  afp.cases    = afp.cases,
  start_year   = 2021,
  end_year     = 2024,
  output       = "flextable"
)
}

}
