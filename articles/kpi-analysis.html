<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>The KPI Analysis Pipeline • sirfunctions</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="The KPI Analysis Pipeline">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sirfunctions</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/sirfunctions.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/generate-polio-data.html">Generating Global Polio Data</a></li>
    <li><a class="dropdown-item" href="../articles/kpi-analysis.html">The KPI Analysis Pipeline</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>The KPI Analysis Pipeline</h1>
            
      

      <div class="d-none name"><code>kpi-analysis.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Polio surveillance key performance indicators (KPIs) are regularly
monitored by national programs, the regional offices of the World Health
Organization (WHO), and the Surveillance Group (SG) of the Global Polio
Eradication Initiative (GPEI).</p>
<p>There are four main KPI tables:</p>
<ol style="list-style-type: decimal">
<li>
<strong>C1</strong> - Certification of Poliomyelitis
Eradication</li>
<li>
<strong>C2</strong> - AFP surveillance</li>
<li>
<strong>C3</strong> - Environmental surveillance</li>
<li>
<strong>C4</strong> - Laboratory surveillance</li>
</ol>
<p>The KPI analysis pipeline will focus on creating these tables,
creating figures based on these tables, and then exporting the results
locally.</p>
</div>
<div class="section level2">
<h2 id="pre-requisites">Pre-requisites<a class="anchor" aria-label="anchor" href="#pre-requisites"></a>
</h2>
<p>Before starting, create a folder in the desktop called
<strong>kpi_analysis</strong>. This folder will contain all of the KPI
runs.</p>
<p>The pipeline is initiated using the <code><a href="../reference/init_kpi.html">init_kpi()</a></code> function.
The function takes three arguments:</p>
<ul>
<li>
<code>path</code>: the absolute path of the kpi_analysis
folder.</li>
<li>
<code>name</code>: the name of the KPI run. By default, it will be
the date <code><a href="../reference/init_kpi.html">init_kpi()</a></code> was ran.</li>
<li>
<code>edav</code>: whether the analysis should access resources from
EDAV or not. EDAV is the data science platform within CDC. For non-CDC
employees, please set this to <code>FALSE</code>.</li>
</ul>
<div class="section level3">
<h3 id="initializing-the-pipeline">Initializing the pipeline<a class="anchor" aria-label="anchor" href="#initializing-the-pipeline"></a>
</h3>
<div class="section level4">
<h4 id="cdc-employees">CDC employees<a class="anchor" aria-label="anchor" href="#cdc-employees"></a>
</h4>
<p>Run the following: <code>init_kpi("path_to_kpi_folder")</code></p>
<p>The function will set up the folder structure within the kpi_analysis
folder, as well as set the paths to export the tables and figures. In
the KPI run folder, there are three subfolders: data, figures, and
tables. The KPI template is also created, which contains all the code
necessary to run the KPI analysis. The function will download the global
polio dataset and the lab data if available. It will load both the polio
and lab data to the R environment.</p>
<p><strong>NOTE:</strong> If there’s a message about being unable to
pull data from EDAV, contact Stephanie Kovacs at <a href="mailto:uvx4@cdc.gov" class="email">uvx4@cdc.gov</a>. This is
likely a permissions issue.</p>
</div>
<div class="section level4">
<h4 id="non-cdc-employees">Non-CDC employees<a class="anchor" aria-label="anchor" href="#non-cdc-employees"></a>
</h4>
<p>Run the following:
<code>init_kpi("path_to_kpi_folder", edav = FALSE)</code></p>
<p>Upon running, it will set up the folder structure but not download
the lab and polio data. There will be several warnings about needing to
create the polio data list locally, as well as saving the lab data
locally. Please follow the instructions included in these warnings. To
create the global polio dataset, please see the
<code>Generating Global Polio Data</code> vignette.</p>
<p>Once <code><a href="../reference/init_kpi.html">init_kpi()</a></code> completely runs, open the template file.
The function will link to the location of this template file and it can
be linked if running the code in RStudio.</p>
</div>
</div>
<div class="section level3">
<h3 id="loading-the-spatial-data">Loading the spatial data<a class="anchor" aria-label="anchor" href="#loading-the-spatial-data"></a>
</h3>
<p>Lines 19-20 of the template loads the country and district
shapefiles. For CDC employees, run the lines as-is. However, for non-CDC
employees, see below:</p>
<div class="section level4">
<h4 id="non-cdc-employees-1">Non-CDC employees<a class="anchor" aria-label="anchor" href="#non-cdc-employees-1"></a>
</h4>
<p>Run the following instead:</p>
<pre><code><span><span class="va">ctry_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_clean_ctry_sp.html">load_clean_ctry_sp</a></span><span class="op">(</span>st_year <span class="op">=</span> <span class="fl">2022</span>, type <span class="op">=</span> <span class="st">"long"</span>, fp <span class="op">=</span> <span class="st">"path to global.ctry.rds"</span>, edav <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">dist_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_clean_dist_sp.html">load_clean_dist_sp</a></span><span class="op">(</span>st_year <span class="op">=</span> <span class="fl">2022</span>, type <span class="op">=</span> <span class="st">"long"</span>, fp <span class="op">=</span> <span class="st">"path to global.dist.rds"</span>, edav <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre>
<p>Replace the string passed in <code>fp</code> with the actual absolute
path to the shapefiles. To generate the shape files, follow the
subsection titled <strong>spatial folder</strong> in the
<code>Generating Global Polio Data</code> vignette.</p>
</div>
</div>
<div class="section level3">
<h3 id="load-lab">Loading the lab information and country prioritization csv
files<a class="anchor" aria-label="anchor" href="#load-lab"></a>
</h3>
<p>The lab information file contains data for each country regarding
their culturing and sequencing capacity, as well as the lab names they
send their samples to. The country prioritization csv file contains
information regarding the SG priority level for each country. For CDC
employees, run the lines as-is. However, for non-CDC employees, see
below:</p>
<div class="section level4">
<h4 id="non-cdc-employees-2">Non-CDC employees<a class="anchor" aria-label="anchor" href="#non-cdc-employees-2"></a>
</h4>
<p>Please request the csv files from Stephanie Kovacs and load these in
R to variables <code>lab_locs</code> (lab info) and
<code>risk_table</code> (priority levels). Use
<code><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">readr::read_csv()</a></code> instead of the base
<code><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv()</a></code> function as the base function renames some of
the columns by default, especially when column names contain spaces.</p>
</div>
<div class="section level4">
<h4 id="cleaning-the-lab-data">Cleaning the lab data<a class="anchor" aria-label="anchor" href="#cleaning-the-lab-data"></a>
</h4>
<p>The lab data is sourced from WHO. Please request this data from
Pham-Minh, Ly Mathilde, Florence at <a href="mailto:phamm@who.int" class="email">phamm@who.int</a> if not already loaded. Then, run the
<code><a href="../reference/clean_lab_data.html">clean_lab_data()</a></code> function. For non-CDC employees, pass the
absolute path to the lab information file in the
<code>lab_locs_path</code> parameter of the cleaning function.</p>
<p>After cleaning, you can use the
<code><a href="../reference/get_lab_date_col_missingness.html">get_lab_date_col_missingness()</a></code> function to check the
proportion of missingness for each date column. It also has a
<code>group_by</code> parameter that can be used to group results (ex.
countries, regions, or labs).</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="analysis">Analysis<a class="anchor" aria-label="anchor" href="#analysis"></a>
</h2>
<div class="section level3">
<h3 id="start-and-end-dates">Start and end dates<a class="anchor" aria-label="anchor" href="#start-and-end-dates"></a>
</h3>
<p>Before creating the table, set the start and end dates. The analyses
are on rolling 12 months. It is important to set the end date day to be
one day before the start date. For example, if the start date is
1/<strong>1</strong>/2023, then end date must be
<strong>12/31</strong>/2025. For start dates in March, please pay
attention to whether the end date is on a leap year. For example (for a
rolling 2 year period), 3/1/2022 will have an end date of 2/29/2024
since 2024 is a leap year but 3/1/23 will have an end date of
2/28/2025.</p>
</div>
<div class="section level3">
<h3 id="creating-the-c1-c4-tables">Creating the C1-C4 tables<a class="anchor" aria-label="anchor" href="#creating-the-c1-c4-tables"></a>
</h3>
<p>For CDC employees, you may run lines 32-38 as-is. However, for
non-CDC employees, the <code>generate_c1-c3_table()</code> functions
require passing the two parameters: <code>risk_table</code> and
<code>lab_locs</code>. Please pass the variables loaded from the <a href="#load-lab">Loading the lab information and country prioritization
csv files</a> section.</p>
</div>
</div>
<div class="section level2">
<h2 id="figures">Figures<a class="anchor" aria-label="anchor" href="#figures"></a>
</h2>
<p>For CDC employees, the section for creating figures can be ran as-is.
However, for non-CDC employees, creating maps need a slight
modification. The functions <code><a href="../reference/generate_sg_priority_map.html">generate_sg_priority_map()</a></code> and
<code><a href="../reference/generate_kpi_ev_map.html">generate_kpi_ev_map()</a></code> need the country shapefile passed to
the <code>ctry_sf</code> parameter. For
<code><a href="../reference/generate_kpi_npafp_map.html">generate_kpi_npafp_map()</a></code> and
<code><a href="../reference/generate_kpi_stool_map.html">generate_kpi_stool_map()</a></code>, the functions need the country
and district shapefile passed in the <code>ctry_sf</code> and
<code>dist_sf</code>, respectively.</p>
<p>The other figure creation function can be ran as-is.</p>
<div class="section level3">
<h3 id="creating-tile-plots">Creating tile plots<a class="anchor" aria-label="anchor" href="#creating-tile-plots"></a>
</h3>
<p>A tile plot can visualize the improvements of indicators over time
for each country. The <code><a href="../reference/generate_kpi_tile.html">generate_kpi_tile()</a></code> can create tile
plots quickly for the C1-C4 tables. It requires the following
parameters: <code>c_table</code> and <code>priority_category</code>.
<code>c_table</code> can be any of the tables generated. By default,
<code>priority_category</code> is set to “HIGH”. It is recommended to
either leave this as-is, or to only create tile plots for less than 25
countries. Otherwise, the tile plot creation may take a long time and
the final image illegible.</p>
</div>
</div>
<div class="section level2">
<h2 id="exporting-tables-and-figures">Exporting tables and figures<a class="anchor" aria-label="anchor" href="#exporting-tables-and-figures"></a>
</h2>
<p>Run the <code><a href="../reference/export_kpi_table.html">export_kpi_table()</a></code> line. Setting the
<code>drop_lab_cols</code> parameter to <code>FALSE</code> will export a
table with numeric columns for each indicator without the proportion
labels. This is useful for creating additional figures using this Excel
file.</p>
</div>
<div class="section level2">
<h2 id="final-notes">Final notes<a class="anchor" aria-label="anchor" href="#final-notes"></a>
</h2>
<p>The template is simply a place to start. Each function has several
parameters that can be tweaked. Thus, reviewing the function
documentations is highly encouraged.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Nishant Kishore, Mervin Keith Cuadera, Nicholas Heaghney, Elizabeth Krow-Lucal, Smita Chavan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
